<!DOCTYPE html><html lang="en" dir="ltr" vocab="http://schema.org" itemType="http://schema.org/WebPage" itemscope=""><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no, minimal-ui"/><style data-href="/styles.0766f83c8101af53a8e7.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}*,:after,:before{box-sizing:inherit;outline:none}body,html{-webkit-overflow-scrolling:touch;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-ms-overflow-style:scrollbar;min-width:320px;height:100%;width:100%;box-sizing:border-box}a,code,h1,h2,h3,h4,h5,h6,html,li,p{text-rendering:optimizeLegibility;font-smoothing:subpixel-antialiased;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:subpixel-antialiased}h1,h2,h3,h4,h5,h6{font-feature-settings:"dlig","liga","lnum","kern"}body{background-color:var(--background-100);font-family:var(--fn-main);font-size:var(--fs-0)}:root{--fn-main:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;--fn-mono:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;--fn-serif:"pt serif",Georgia,Cambria,times new roman,Times,serif;--fs-0:16px;--cs-xxs:2px;--cs-xs:4px;--cs-sm:8px;--cs-md:12px;--cs-lg:16px;--cs-xl:24px;--cs-xxl:32px;--ls-xxs:16px;--ls-xs:24px;--ls-sm:32px;--ls-md:48px;--ls-lg:64px;--ls-xl:96px;--ls-xxl:160px}body.dark{--background-100:#101011;--background-300:#1b1b1d;--background-500:#343434;--primary-100:hsl(266 48% 15%);--primary-300:hsl(266 48% 35%);--primary-500:hsl(266 48% 50%);--primary-700:hsl(266 48% 75%);--primary-900:hsl(266 48% 96%);--highlight-keyword:var(--primary-500);--text-primary:#d2d2d2;--text-secondary:#9f9f9f}body.dark,body.light{--highlight-comment:green;--highlight-literal:#a31515}body.light{--background-100:#fff;--background-300:#f8f8f8;--background-500:#e0e0e0;--primary-100:hsl(30 98% 96%);--primary-300:hsl(30 98% 75%);--primary-500:hsl(30 98% 50%);--primary-700:hsl(30 98% 35%);--primary-900:hsl(30 98% 15%);--highlight-keyword:#fd8103;--text-primary:#000;--text-secondary:#404040}a{color:var(--primary-500);text-decoration:none;border:solid transparent;border-width:0 0 3px}a:focus{border-color:var(--primary-500)}.visually-hidden:not(:focus){position:absolute!important;width:1px!important;height:1px!important;padding:0!important;margin:-1px!important;overflow:hidden!important;clip:rect(0,0,0,0)!important;white-space:nowrap!important;border:0!important}.list{margin:0;padding:0;list-style:none}.repositories{display:grid;column-gap:var(--ls-xxs);row-gap:1em;padding:0 0 var(--ls-xl) 0}@media screen and (min-width:700px){.repositories{grid-template-columns:repeat(2,1fr)}}@media screen and (min-width:1050px){.repositories{grid-template-columns:repeat(3,1fr)}}.post__content{counter-reset:h2}.post__content h2{counter-reset:h3}.post__content h3{counter-reset:h4}.post__content h4{counter-reset:h5}.post__content h5{counter-reset:h6}.post__content h2:before{counter-increment:h2;content:counter(h2) ". "}.post__content h3:before{counter-increment:h3;content:counter(h2) "." counter(h3) ". "}.post__content h4:before{counter-increment:h4;content:counter(h2) "." counter(h3) "." counter(h4) ". "}.post__content h5:before{counter-increment:h5;content:counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) ". "}.post__content h6:before{counter-increment:h6;content:counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) "." counter(h6) ". "}.post h1,.post h2,.post h3,.post h4,.post h5,.post h6{font-feature-settings:"dlig","liga","lnum","kern";font-family:var(--fn-main);font-style:normal;font-weight:700;letter-spacing:-.02em}.post__content,.post__content blockquote,.post__content blockquote p,.post__content ol li,.post__content p,.post__content ul li{font-family:var(--fn-serif);font-style:normal;font-weight:400;font-size:1.25rem;line-height:1.5}.post__content code,.post__content pre{text-rendering:optimizeLegibility;font-smoothing:subpixel-antialiased;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:subpixel-antialiased}.post__content{overflow-wrap:break-word;word-break:break-word;word-wrap:break-word}.post__header{margin:var(--ls-xl) 0;text-align:center;color:var(--text-primary)}.post__content{max-width:850px;margin-left:auto;margin-right:auto;color:var(--text-primary)}.post__content details summary{font-family:var(--fn-main);font-weight:500}.post__content a{border:underline currentcolor;border-width:0 0 1px;letter-spacing:-.005em;color:inherit}.post__content a:focus,.post__content a:hover{color:var(--primary-500);border:solid var(--primary-500);border-width:0 0 2px}.post__content abbr{border-bottom:1px dashed var(--text-secondary);text-decoration:none;cursor:help}.post__content h2,.post__content h3{margin-top:var(--ls-md)}.post__content h4{margin-top:var(--ls-sm)}.post__content h1+p,.post__content h2+p,.post__content h3+p,.post__content h4+p,.post__content h5+p,.post__content h6+p{margin-top:var(--ls-xxs)}.post__content b,.post__content strong{font-weight:700}.post__content em{font-feature-settings:"liga" on,"salt" on}.post__content dl,.post__content ol,.post__content p,.post__content ul{font-feature-settings:"kern","onum","liga"}.post__content p{letter-spacing:.01rem;margin-top:var(--ls-xxs);margin-bottom:0}.post__content p img{max-width:100%;height:auto;margin:var(--ls-sm) auto var(--ls-xxs)}.post__content li>code,.post__content p>code{padding:.15rem .25rem;margin:0 .1rem}.post__content ol,.post__content ul{margin:var(--ls-sm) 0;padding:0;counter-reset:post}.post__content ol li,.post__content ul li{margin-left:var(--ls-sm);margin-bottom:var(--ls-xxs);letter-spacing:-.005em}.post__content ol ol,.post__content ol ul,.post__content ul ol,.post__content ul ul{margin:var(--ls-xxs) 0 0}.post__content blockquote,.post__content blockquote p{font-style:italic;letter-spacing:-.01em;border-left:3px solid var(--text-secondary);padding-left:20px;padding-bottom:2px;margin-left:-23px;margin-top:29px;color:var(--text-secondary)}.post__content code,.post__content pre{font-family:var(--fn-mono);font-size:18px;font-weight:400;font-style:normal;line-height:1.5;font-feature-settings:"liga" 0;background-color:var(--background-300);color:var(--text-secondary);border-radius:5px}.post__content pre{-webkit-overflow-scrolling:touch;margin:var(--ls-md) 0;padding:var(--ls-xs);letter-spacing:0;overflow:auto}.post__content code{letter-spacing:-.005em}.post__content code .keyword{color:var(--highlight-keyword)}.post__content code .comment{color:var(--highlight-comment)}.post__content code .string{color:var(--highlight-literal)}.post__content code .gatsby-highlight-code-line{background-color:var(--background-500);display:block;margin-right:calc(var(--ls-xs)*-1);margin-left:calc(var(--ls-xs)*-1);padding-right:1em;padding-left:1.25em;border-left:.25em solid var(--primary-500)}.post__content figure{margin:0}.post__content hr{display:block;margin:var(--ls-xl) 0;padding:0;border:0;height:0;text-align:center}.post__content hr:before{font-family:var(--fn-serif);font-weight:400;font-style:italic;font-size:28px;letter-spacing:.6em;content:"...";display:inline-block;margin-left:.6em;color:var(--text-secondary);position:relative;top:-30px}.post__content mark{background-color:var(--background-100)}.post h1{font-size:3rem}@media screen and (min-width:800px){.post h1{font-size:2rem}}.post h2{font-size:1.9rem;line-height:1.1}.post h3{font-size:1.8rem;line-height:1.15}.post h4{font-size:1.6rem;line-height:1.2}.toc{margin:2rem 0}.toc ul{list-style-type:none;counter-reset:toc}.toc li{display:table;counter-increment:toc}.toc li:before{display:table-cell;padding:0 .5rem 0 0;content:counters(toc,".") ". "}.toc li,.toc li p,.toc li ul,.toc li ul>li{margin-top:var(--cs-xxs)!important;margin-bottom:var(--cs-xxs)!important}.toc li ul,.toc li ul>li{margin:0!important}.skip{position:absolute;top:21px;left:1rem;font-family:var(--fn-main);font-weight:700;font-size:1.25rem;background-color:var(--primary-500);color:var(--text-primary);z-index:5}.header{position:fixed;top:0;left:0;width:100%;height:var(--ls-lg);background-color:rgba(var(--background-100),.85);box-shadow:0 0 10px -2px var(--background-100);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:4}.header__content{display:flex;align-items:center;margin:0 auto;padding:0 var(--cs-lg);height:100%;max-width:1250px;list-style:none}.header__item{font-family:var(--fn-main);font-weight:500;padding:0 0 0 var(--cs-xl)}.header__item a{color:var(--text-primary)}.header__item--logo{flex:1 1;padding:0;font-weight:700;font-size:1.25rem}:root{--toggle-light:hsl(30 98% 50%);--toggle-light-hover:hsl(30 98% 35%);--toggle-dark:hsl(266 48% 50%);--toggle-dark-hover:hsl(266 48% 35%)}.react-toggle{display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;touch-action:pan-x;-webkit-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:40px;height:24px;padding:0;border-radius:30px;background-color:var(--toggle-light);transition:all .2s ease}.react-toggle:hover .react-toggle-track{background-color:var(--toggle-light-hover)}.react-toggle--checked .react-toggle-track{background-color:var(--toggle-dark)}.react-toggle--checked:hover .react-toggle-track{background-color:var(--toggle-dark-hover)}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border:1px solid var(--toggle-light);border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms}.react-toggle--checked .react-toggle-thumb{left:17px;border-color:var(--toggle-dark)}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 0 1px hsla(0,0%,100%,.25)}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 0 5px hsla(0,0%,100%,.25)}.footer{position:relative;margin:0 auto;padding:var(--ls-lg) var(--ls-xxs);max-width:1250px;width:100%}.footer__menu{padding:0;margin:0 0 var(--cs-xl)}.footer__item{display:inline-block;margin:0 var(--cs-md);font-family:var(--fn-mono);font-size:16px;line-height:32px}@media screen and (min-width:700px){.footer__item{margin:0 var(--cs-lg)}}.footer__item--contact{float:right}.footer__item a{color:var(--text-primary)}.footer__item-text{display:none}@media screen and (min-width:700px){.footer__item-text{display:initial}}.footer__item-icon{position:relative;width:22px;fill:var(--text-primary)}.footer__item-icon--linkedin{top:-1px;width:20px}.footer__item-icon--youtube{top:2px;width:26px}@media screen and (min-width:700px){.footer__item-icon{display:none}}.footer__contact-text{display:none}@media screen and (min-width:375px){.footer__contact-text{display:initial}}.footer__contact-icon{position:relative;top:4px;width:22px;fill:var(--text-primary)}@media screen and (min-width:375px){.footer__contact-icon{display:none}}.footer__source{margin:var(--cs-xl) var(--cs-lg) 0;color:var(--text-primary)}.post-excerpt__wrapper{max-width:600px;margin:var(--ls-lg) 0}.post-excerpt__title{margin:var(--cs-lg) 0}.post-excerpt__title a{color:var(--text-primary)}.post-excerpt__content{margin:0;font-family:var(--fn-serif);line-height:1.5;letter-spacing:-.003em;color:var(--text-secondary)}.post-excerpt__date{margin:0;font-family:var(--fn-mono);font-size:14px;color:var(--text-secondary)}.hero{width:100%;height:50vh;min-height:500px}.hero__wrapper{display:flex;align-items:center;justify-content:center;width:100%;height:100%;background-color:var(--background-300);background:linear-gradient(180deg,var(--background-100),var(--background-300) 40%) fixed}.hero__title{margin:0 0 var(--cs-lg);font-size:65px;line-height:65px;letter-spacing:-.003em;color:var(--text-primary)}@media screen and (min-width:800px){.hero__title{font-size:83px;line-height:83px}}.hero__subtitle{margin:0 0 0 var(--cs-xs);font-size:18px;letter-spacing:-.005em;color:var(--text-primary)}@media screen and (min-width:800px){.hero__subtitle{font-size:16px}}.hero__subtitle span{display:none}@media screen and (min-width:800px){.hero__subtitle span{display:initial}}.content{position:relative;margin:0 auto;padding:var(--ls-lg) var(--ls-xxs);max-width:1250px;width:100%}.dark .repository__link{background-color:var(--background-300)}.repository__link{position:relative;display:flex;flex-direction:column;height:100%;padding:var(--cs-lg) var(--cs-md) var(--cs-md);transition-property:transform,box-shadow;transition-duration:.2s;transition-timing-function:ease-in-out;border-radius:6px;border:1px solid var(--background-500);box-shadow:0 1px 1px rgba(0,0,0,.08);outline:0}.repository__link:focus,.repository__link:hover{transform:scale(1.025)}.repository__link:hover{box-shadow:0 5px 15px -5px rgba(0,0,0,.1)}.repository__link:focus{border-color:var(--primary-300);box-shadow:0 0 0 5px var(--primary-100)}.repository__meta{display:flex;position:absolute;top:1rem;right:1rem;margin:0;padding:0;list-style:none;font-size:.85rem;background-image:linear-gradient(90deg,rgba(var(--background-100),1e-7),var(--background-100) 15%)}.repository__meta,.repository__name{font-family:var(--fn-mono);color:var(--text-primary)}.repository__name{margin:0 var(--cs-sm);font-size:.9rem;font-weight:500}.repository__description{flex:1 1;margin:var(--cs-md) var(--cs-sm) var(--cs-lg);font-size:.9rem;line-height:1.25rem;color:var(--text-primary)}.index-module--keyword--23WFF{display:inline-block;padding:var(--cs-xs) var(--cs-sm);margin:0 var(--cs-xxs);font-size:.8rem;color:var(--primary-700);background-color:var(--primary-100);border-radius:3px;white-space:nowrap}.heading__wrapper{display:block;width:100%;height:auto;text-align:center}.heading__text{max-width:460px;margin-left:auto;margin-right:auto;color:var(--text-primary)}.heading__text--h2{margin-top:0;margin-bottom:var(--ls-xxs);font-size:2.5rem;font-weight:700}.heading__text--h3{margin-bottom:var(--ls-lg);font-size:1rem;font-weight:400;line-height:1.5}</style><meta name="generator" content="Gatsby 3.0.1"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{all:inherit;bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">Publishing tree shaking friendly npm packages • Bartosz Łaniewski</title><meta data-react-helmet="true" name="description" content="With the rise of ES2015, modules have officially become an integral part of JavaScript. By their nature, ES2015 modules are static and can get optimized at the…"/><meta data-react-helmet="true" property="og:title" content="Publishing tree shaking friendly npm packages"/><meta data-react-helmet="true" property="og:description" content="With the rise of ES2015, modules have officially become an integral part of JavaScript. By their nature, ES2015 modules are static and can get optimized at the…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Publishing tree shaking friendly npm packages"/><meta data-react-helmet="true" name="twitter:description" content="With the rise of ES2015, modules have officially become an integral part of JavaScript. By their nature, ES2015 modules are static and can get optimized at the…"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-ab171d9e9331e6d08aa5.js"/><link as="script" rel="preload" href="/framework-6e16d2e965452ee6998a.js"/><link as="script" rel="preload" href="/app-4596f7dc087fcc733ad4.js"/><link as="script" rel="preload" href="/commons-ae4853ea5660ca11fc02.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-b339f30a9bb3b70e7b42.js"/><link as="fetch" rel="preload" href="/page-data/2018-04-29-publishing-packages-to-npm/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2176249065.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3000541721.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="light"><script>
                window.__theme = "light";
                window.__onThemeChange = function onThemeChange() {};

                function setTheme(newTheme) {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                  window.__onThemeChange(newTheme);
                }

                window.__setPreferredTheme = function setPreferredTheme(newTheme) {
                  setTheme(newTheme);
                  localStorage.setItem('theme', newTheme);
                }

                var preferredTheme = localStorage.getItem('theme');
                var prefersDarkQuery = window.matchMedia('(prefers-color-scheme: dark)');

                prefersDarkQuery.addListener(function (event) {
                  window.__setPreferredTheme(event.matches ? 'dark' : 'light')
                });

                setTheme(preferredTheme || (prefersDarkQuery.matches ? 'dark' : 'light'));
            </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><a class="skip visually-hidden" href="#content">Skip to main content</a><nav class="header" itemType="http://schema.org/SiteNavigationElement" itemscope=""><ul class="header__content"><li class="header__item header__item--logo"><a rel="index" title="Go to main page" href="/">Łanek</a></li><li class="header__item"><a class="" href="/posts/">Devblog</a></li><li class="header__item"><a target="_blank" rel="author noopener noreferrer" href="https://drive.google.com/file/d/1Zh3NaFogEkufa25H7qxqj0QdqHPzyfZX/view" title="Get my résumé from Google Drive">Résumé</a></li><li class="header__item"><div class="react-toggle"><div class="react-toggle-track"><div class="react-toggle-track-check"></div><div class="react-toggle-track-x"></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Toggle theme" class="react-toggle-screenreader-only"/></div></li></ul></nav><main id="content" class="content" itemProp="mainContentOfPage"><article class="post" itemscope="" itemType="http://schema.org/Article"><header class="post__header"><h1 itemProp="headline">Publishing tree shaking friendly npm packages</h1><p>April 28, 2018</p></header><section itemProp="articleBody" class="post__content"><p>With the rise of ES2015, modules have officially become an integral part of JavaScript. By their nature, ES2015 modules are static and can get optimized at the compile time. Various tools and techniques have been created to minimize the total size of generated bundles. The one described in this article is called tree shaking.</p>
<div class="toc">
<ul>
<li>
<p><a href="#introduction-to-npm-packages">Introduction to npm packages</a></p>
<ul>
<li><a href="#basic-terminology--overview">Basic terminology &#x26; overview</a></li>
<li><a href="#the-role-of-tree-shaking">The role of tree shaking</a></li>
</ul>
</li>
<li>
<p><a href="#creating-tree-shaking-friendly-packages">Creating tree shaking friendly packages</a></p>
<ul>
<li><a href="#directory-structure-overview">Directory structure overview</a></li>
<li><a href="#compiling-and-building-the-package">Compiling and building the package</a></li>
<li><a href="#copying-required-files-into-package">Copying required files into package</a></li>
</ul>
</li>
<li>
<p><a href="#limitations-and-solutions">Limitations and solutions</a></p>
<ul>
<li><a href="#side-effects-in-module-bundles">Side effects in module bundles</a></li>
<li><a href="#wrong-specs-implementation">Wrong specs implementation</a></li>
<li>
<p><a href="#class-based-tree-shaking">Class-based tree shaking</a></p>
<ul>
<li><a href="#bind-operator-proposal">Bind operator proposal</a></li>
<li><a href="#pipeline-operator-proposal">Pipeline operator proposal</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#resources">Resources</a></li>
</ul>
</div>
<h2>Introduction to npm packages</h2>
<p><strong>npm</strong> is the most popular package manager for JavaScript. It is shipped by default with Node.js – the JavaScript runtime environment. Each month, there are over <a href="https://www.npmjs.com/">20 billions downloads</a> from the npm registry which counts more than half a million different packages.</p>
<h3>Basic terminology &#x26; overview</h3>
<p>A package is a directory described by a <code class="language-text">package.json</code>. Each package is composed of one or more modules which can be loaded by Node.js’ <code class="language-text">require()</code>. In most cases, a package will expose a single module via the <code class="language-text">main</code> field specified in <code class="language-text">package.json</code>. If there’s no such field, npm will look for <code class="language-text">index.js</code> in the root directory.</p>
<p>In the era of JavaScript bundlers such as <a href="https://webpack.js.org/">Webpack</a> or <a href="http://browserify.org/">Browserify</a>, the idea of a single entry-point is strongly encouraged. In fact, most of the bundlers will output a unique JavaScript file containing all built modules. For example, let’s consider the following code:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Source file: index.js</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">as</span> moduleA <span class="token keyword">from</span> <span class="token string">"./src/moduleA"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">as</span> moduleB <span class="token keyword">from</span> <span class="token string">"./src/moduleB"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">as</span> moduleC <span class="token keyword">from</span> <span class="token string">"./src/moduleC"</span><span class="token punctuation">;</span></code></pre></div>
<p>To build this package, Webpack will start by compiling the source file (called <em>entry point</em>). It will then move from <code class="language-text">import</code> to <code class="language-text">import</code> and include every required file in the build pipe. It will generate a single bundle containing all the required modules, as follows:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Webpack stuff</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">"./index.js"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">"use strict"</span><span class="token punctuation">;</span>
    <span class="token comment">// Compiled entry-point</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"./src/moduleA.js"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">"use strict"</span><span class="token punctuation">;</span>
    <span class="token comment">// Compiled moduleA</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"./src/moduleB.js"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">"use strict"</span><span class="token punctuation">;</span>
    <span class="token comment">// Compiled moduleB</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"./src/moduleC.js"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">"use strict"</span><span class="token punctuation">;</span>
    <span class="token comment">// Compiled moduleC</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Once published to npm, each module can be loaded using Node.js’ <code class="language-text">require()</code> (or <a href="https://tc39.github.io/ecma262/#sec-imports">ES2015 <code class="language-text">import</code></a>) as follows:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> moduleA<span class="token punctuation">,</span> moduleB<span class="token punctuation">,</span> moduleC <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"package"</span><span class="token punctuation">;</span>

moduleA<span class="token punctuation">.</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
moduleB<span class="token punctuation">.</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
moduleC<span class="token punctuation">.</span><span class="token function">internal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The reason why such bundlers can work, is that <a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure" title="Exploring JS – Static module structure">ES2015 packages are static by nature</a>: you can predict which modules are being imported and exported just by analysing the code, without the need to execute it. However, this has some drawbacks:</p>
<ul>
<li><strong>conditional imports and exports</strong> are unsupported – you have to declare your imports at the top-level;</li>
<li>both imports and exports <strong>cannot have any dynamic parts</strong> – you cannot use string concatenation in <code class="language-text">require()</code>.</li>
</ul>
<h3>The role of tree shaking</h3>
<p>Tree shaking simply means <em>dead code elimination</em> – a script will perform code analysis for a given bundle and check at the <strong>compile (build) time</strong> which modules are never being used. Let’s take the previous example:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> moduleA<span class="token punctuation">,</span> moduleB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"package"</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">package</code> exports <code class="language-text">moduleA</code>, <code class="language-text">moduleB</code> and <code class="language-text">moduleC</code> but only the first two are required. Without tree shaking, the final bundle would be a lot bigger since it would contain unreachable code. During bundling, unused exports can be removed, potentially resulting in significant space savings.</p>
<blockquote>
<p>Utilizing the tree shaking and dead code elimination can significantly reduce the code size we have in our application. The less code we send over the wire the more performant the application will be. – <a href="https://medium.com/@netxm/what-is-tree-shaking-de7c6be5cadd">Alex Bachuk</a>.</p>
</blockquote>
<h2>Creating tree shaking friendly packages</h2>
<p>Our goal will be to expose multiple module bundles from a single package, so ones can <code class="language-text">import</code> only necessary parts instead of the entire library:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> moduleA <span class="token keyword">from</span> <span class="token string">"package/moduleA"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> moduleB <span class="token keyword">from</span> <span class="token string">"package/moduleB"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> funcA<span class="token punctuation">,</span> funcB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"package/moduleC"</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>If we import only <code class="language-text">moduleA</code>, the two others modules will not be included in the final bundle because they aren’t required anywhere.</li>
<li>If we import only a specific function from a module (ex. <code class="language-text">funcA</code>), the rest of the module’s content will be ignored.</li>
</ul>
<p>Additionally, we don’t have to access a named export like in previous examples. That means we don’t have to do a slow, dynamic property lookup. In our case, we statically know the content and can optimize the access.</p>
<h3>Directory structure overview</h3>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">├── scripts/
│   └── copy.js
├── package/
│   └── package.json
├── source/
│   ├── moduleA/
│   ├── moduleB/
│   ├── moduleC/
│   └── index.js
├── README.md
├── LICENSE
└── package.json</code></pre></div>
<ul>
<li><code class="language-text">scripts/</code> will contain all JavaScript binaries that will be used to build your package. Those steps will be automated via <code class="language-text">package.json</code> scripts.</li>
<li><code class="language-text">package/</code> directory is where your package will actually reside once it is compiled. This is the directory that will be pushed to the npm registry.</li>
<li><code class="language-text">source/</code> directory is where your package source resides. It will not be pushed to the npm registry, but should be contained in the repository.</li>
</ul>
<p>As you can see, there are two <code class="language-text">package.json</code> files. The one at the root will be used to declare your <code class="language-text">dependencies</code>, basic package data and build scripts. The second one is declaring in details the package that will be pushed to the npm registry.</p>
<h3>Compiling and building the package</h3>
<p>In this article, we will use <a href="https://babeljs.io/">Babel</a> for the compilation process. Babel is a JavaScript transpiler that converts ECMAScript and other JavaScript subsets into plain JavaScript that can be used in any environment. First, you need to install Babel as a development dependency in your project:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev babel-cli</code></pre></div>
<p>For full installation details, I encourage you to check <a href="https://babeljs.io/docs/setup/">Babel’ setup section in their documentation</a>. Once Babel is installed, we can define a few scripts in <code class="language-text">/package.json</code>:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"rimraf"</span><span class="token operator">:</span> <span class="token string">"^2.6.2"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"prepare"</span><span class="token operator">:</span> <span class="token string">"npm start"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"npm run clean &amp;&amp; npm run build &amp;&amp; npm run copy"</span><span class="token punctuation">,</span>
    <span class="token property">"clean"</span><span class="token operator">:</span> <span class="token string">"npx rimraf ./package/*"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"npx babel ./source --out-dir ./package"</span><span class="token punctuation">,</span>
    <span class="token property">"copy"</span><span class="token operator">:</span> <span class="token string">"npx babel-node ./scripts/copy.js"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<ul>
<li><code class="language-text">npm run clean</code> will remove built modules from <code class="language-text">/package</code> directory.</li>
<li><code class="language-text">npm run build</code> will build modules and pipe the bundles to <code class="language-text">/package</code> directory.</li>
<li><code class="language-text">npm run copy</code> will execute <code class="language-text">/scripts/copy.js</code> script described in the next section.</li>
</ul>
<p>Note that it is important to set <code class="language-text">&quot;private&quot;: true</code> in <code class="language-text">/package.json</code>. It will prevent you from accidentally pushing your entire entire repository to the npm registry instead of only the builded modules.</p>
<h3>Copying required files into package</h3>
<p>The script below will copy important files such as <code class="language-text">README.md</code> and <code class="language-text">LICENSE</code> to your final package. Additionally, it will create a brand new <code class="language-text">package.json</code>.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// File: /scripts/copy.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> basename<span class="token punctuation">,</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> copy<span class="token punctuation">,</span> writeFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"fs-extra"</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"../package/"</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">copy</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Copied </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createPackageFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> oldPckgPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"../package.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> oldPckgData <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>oldPckgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">delete</span> oldPckgData<span class="token punctuation">.</span>private<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> oldPckgData<span class="token punctuation">.</span>scripts<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> oldPckgData<span class="token punctuation">.</span>devDependencies<span class="token punctuation">;</span>

  <span class="token keyword">const</span> newPckgPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"../package/package.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newPckgData <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>oldPckgData<span class="token punctuation">,</span> <span class="token punctuation">{</span> main<span class="token operator">:</span> <span class="token string">"./index.js"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">writeFile</span><span class="token punctuation">(</span>newPckgPath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newPckgData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Created package.json in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newPckgPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token string">"README.md"</span><span class="token punctuation">,</span> <span class="token string">"LICENSE"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">copyFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">createPackageFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Limitations and solutions</h2>
<p>Tree shaking is a relatively new technology and still have some limitations. While not every single one can be resolved directly in tree shaking, there are various ways around these problems.</p>
<h3>Side effects in module bundles</h3>
<p>Some modules have side effects: they can perform additional tasks such as modifying global variables instead of just exporting their content. According to the ECMAScript specifications, all child modules must be evaluated because they could contain side effects. Let’s take the following examples:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// moduleA</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Side effect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token comment">/* … */</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token comment">/* … */</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// moduleB</span>
window<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token comment">/* … */</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token comment">/* … */</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token comment">/* … */</span><span class="token punctuation">;</span></code></pre></div>
<p>Because of this potential behaviour, tree shaking cannot remove all unreachable code. However, some bundlers, such as Webpack, drop the responsibility on the developers by providing a <code class="language-text">sideEffect</code> option. By setting this flag to <code class="language-text">false</code>, you indicate that your package is a <em>pure module</em> and doesn’t have any side effects. Therefore, it can get aggressively optimized.</p>
<h3>Wrong specs implementation</h3>
<blockquote>
<p>Current tooling differs on the correct way to handle default imports/exports. Avoiding them all together can help avoid tooling bugs and conflicts. – <a href="https://palantir.github.io/tslint/rules/no-default-export/" title="TSLint rules – no default export">TSLint rules</a></p>
</blockquote>
<h3>Class-based tree shaking</h3>
<p>Class-based tree shaking is currently not supported because of the dynamic nature of JavaScript’s property accessors – they cannot be statically determined, especially when using the bracket notation. Let’s consider the following example:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

bar<span class="token punctuation">.</span><span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token punctuation">[</span><span class="token string">"methodB"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">method</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token punctuation">[</span><span class="token string">"methodD"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>As you can see, <code class="language-text">methodA</code> and <code class="language-text">methodB</code> can be statically determined as being used at compile time, but this is not be the case for the last two cases. A potential solution to this problem could be to import methods separately and call them with an instance:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Foo<span class="token punctuation">,</span> <span class="token punctuation">{</span> methodA<span class="token punctuation">,</span> methodB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">methodA</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> <span class="token string">"param"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">methodB</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> <span class="token string">"param"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This doesn’t solve cases like <code class="language-text">methodD</code> in the previous example but, at least, can be optimized by tree shaking. There are different proposals which could serve this purpose a little bit better.</p>
<h4>Bind operator proposal</h4>
<blockquote>
<p>The :: operator creates a bound function such that the left hand side of the operator is bound as the this variable to the target function on the right hand side. By providing syntactic sugar for these use cases we will enable a new class of “virtual method” library, which will have usability advantages over the standard adapter patterns in use today. – <a href="https://github.com/tc39/proposal-bind-operator" title="ECMAScript This-Binding Syntax">tc39/proposal-bind-operator</a></p>
</blockquote>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Foo<span class="token punctuation">,</span> <span class="token punctuation">{</span> methodA<span class="token punctuation">,</span> methodB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token operator">:</span><span class="token operator">:</span><span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token operator">:</span><span class="token operator">:</span><span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h4>Pipeline operator proposal</h4>
<blockquote>
<p>This proposal introduces a new operator |> similar to <em>F#, OCaml, …, Hack and LiveScript</em>, as well as UNIX pipes. It’s a backwards-compatible way of streamlining chained function calls in a readable, functional manner, and provides a practical alternative to extending built-in prototypes. – <a href="https://github.com/tc39/proposal-pipeline-operator" title="ESNext Proposal: The Pipeline Operator">tc39/proposal-pipeline-operator</a></p>
</blockquote>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Foo<span class="token punctuation">,</span> <span class="token punctuation">{</span> methodA<span class="token punctuation">,</span> methodB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar <span class="token operator">|</span><span class="token operator">></span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar <span class="token operator">|</span><span class="token operator">></span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Resources</h2>
<ol>
<li><a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure" title="Exploring JS – Static module structure">Exploring JS – Static module structure</a></li>
<li><a href="https://github.com/tc39/proposal-bind-operator" title="ECMAScript This-Binding Syntax">ECMAScript – This-Binding Syntax</a></li>
<li><a href="https://github.com/tc39/proposal-pipeline-operator" title="ESNext Proposal: The Pipeline Operator">ECMAScript – The Pipeline Operator</a></li>
<li><a href="https://rollupjs.org/guide/en#tree-shaking" title="Rollup – Tree shaking documentation">Rollup – Tree shaking documentation</a></li>
<li><a href="https://webpack.js.org/guides/tree-shaking/" title="Webpack – Tree shaking documentation">Webpack – Tree shaking documentation</a></li>
<li><a href="http://david-rodenas.com/posts/rollup-vs-webpack-and-tree-shaking" title="Rollup vs. Webpack – Tree shaking">Rollup vs Webpack2 – David Rodenas</a></li>
</ol></section></article></main><footer class="footer" itemType="http://schema.org/WPFooter" itemscope=""><nav typeof="http://schema.org/ContactPoint" itemscope=""><ul class="footer__menu"><li class="footer__item"><a target="_blank" itemProp="url" rel="noopener noreferrer" href="https://github.com/Bartozzz"><svg class="footer__item-icon footer__item-icon--github" role="img" viewBox="0 0 24 24"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="footer__item-text">GitHub</span></a></li><li class="footer__item"><a target="_blank" itemProp="url" rel="noopener noreferrer" href="https://dribbble.com/bartozzz"><svg class="footer__item-icon footer__item-icon--dribbble" role="img" viewBox="0 0 24 24"><title>Dribbble icon</title><path d="M12 24C5.385 24 0 18.615 0 12S5.385 0 12 0s12 5.385 12 12-5.385 12-12 12zm10.12-10.358c-.35-.11-3.17-.953-6.384-.438 1.34 3.684 1.887 6.684 1.992 7.308 2.3-1.555 3.936-4.02 4.395-6.87zm-6.115 7.808c-.153-.9-.75-4.032-2.19-7.77l-.066.02c-5.79 2.015-7.86 6.025-8.04 6.4 1.73 1.358 3.92 2.166 6.29 2.166 1.42 0 2.77-.29 4-.814zm-11.62-2.58c.232-.4 3.045-5.055 8.332-6.765.135-.045.27-.084.405-.12-.26-.585-.54-1.167-.832-1.74C7.17 11.775 2.206 11.71 1.756 11.7l-.004.312c0 2.633.998 5.037 2.634 6.855zm-2.42-8.955c.46.008 4.683.026 9.477-1.248-1.698-3.018-3.53-5.558-3.8-5.928-2.868 1.35-5.01 3.99-5.676 7.17zM9.6 2.052c.282.38 2.145 2.914 3.822 6 3.645-1.365 5.19-3.44 5.373-3.702-1.81-1.61-4.19-2.586-6.795-2.586-.825 0-1.63.1-2.4.285zm10.335 3.483c-.218.29-1.935 2.493-5.724 4.04.24.49.47.985.68 1.486.08.18.15.36.22.53 3.41-.43 6.8.26 7.14.33-.02-2.42-.88-4.64-2.31-6.38z"></path></svg><span class="footer__item-text">Dribbble</span></a></li><li class="footer__item"><a target="_blank" itemProp="url" rel="noopener noreferrer" href="https://linkedin.com/in/bartozzz"><svg class="footer__item-icon footer__item-icon--linkedin" role="img" viewBox="0 0 24 24"><title>LinkedIn icon</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg><span class="footer__item-text">LinkedIn</span></a></li><li class="footer__item"><a target="_blank" itemProp="url" rel="noopener noreferrer" href="https://youtube.com/channel/UCIC1vaSJwSJ2sqKWC3wTTmQ"><svg class="footer__item-icon footer__item-icon--youtube" role="img" viewBox="0 0 24 24"><title>YouTube icon</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg><span class="footer__item-text">YouTube</span></a></li><li class="footer__item footer__item--contact"><a target="_blank" itemProp="email" rel="noopener noreferrer" href="mailto:hi@laniewski.me"><svg class="footer__contact-icon" role="img" viewBox="0 0 24 24"><title>Cotnact me</title><path d="M15.61 12c0 1.99-1.62 3.61-3.61 3.61-1.99 0-3.61-1.62-3.61-3.61 0-1.99 1.62-3.61 3.61-3.61 1.99 0 3.61 1.62 3.61 3.61M12 0C5.383 0 0 5.383 0 12s5.383 12 12 12c2.424 0 4.761-.722 6.76-2.087l.034-.024-1.617-1.879-.027.017A9.494 9.494 0 0 1 12 21.54c-5.26 0-9.54-4.28-9.54-9.54 0-5.26 4.28-9.54 9.54-9.54 5.26 0 9.54 4.28 9.54 9.54a9.63 9.63 0 0 1-.225 2.05c-.301 1.239-1.169 1.618-1.82 1.568-.654-.053-1.42-.52-1.426-1.661V12A6.076 6.076 0 0 0 12 5.93 6.076 6.076 0 0 0 5.93 12 6.076 6.076 0 0 0 12 18.07a6.02 6.02 0 0 0 4.3-1.792 3.9 3.9 0 0 0 3.32 1.805c.874 0 1.74-.292 2.437-.821.719-.547 1.256-1.336 1.553-2.285.047-.154.135-.504.135-.507l.002-.013c.175-.76.253-1.52.253-2.457 0-6.617-5.383-12-12-12"></path></svg><span class="footer__contact-text">Get in touch</span></a></li></ul></nav><p class="footer__source" itemProp="description">Hand-coded using Gatsby, TypeScript and more.<!-- --> <a target="_blank" itemProp="url" rel="noopener noreferrer" href="https://github.com/Bartozzz/bartozzz.github.io">See the source.</a></p></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2018-04-29-publishing-packages-to-npm/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f6b5fa3802b0dba31afd.js"],"app":["/app-4596f7dc087fcc733ad4.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-17ff38c864b82ed2840d.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-ad37ad7babf6c16ae3e5.js"],"component---src-pages-posts-tsx":["/component---src-pages-posts-tsx-025f76052328ecbb7bad.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-b339f30a9bb3b70e7b42.js"]};/*]]>*/</script><script src="/polyfill-f6b5fa3802b0dba31afd.js" nomodule=""></script><script src="/component---src-templates-blog-post-tsx-b339f30a9bb3b70e7b42.js" async=""></script><script src="/commons-ae4853ea5660ca11fc02.js" async=""></script><script src="/app-4596f7dc087fcc733ad4.js" async=""></script><script src="/framework-6e16d2e965452ee6998a.js" async=""></script><script src="/webpack-runtime-ab171d9e9331e6d08aa5.js" async=""></script></body></html>